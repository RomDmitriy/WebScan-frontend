import prisma from '@/prisma/db';
import { NextRequest, NextResponse } from 'next/server';

async function GET(req: NextRequest) {
	const vulnId = req.nextUrl.searchParams.get('vuln_id') as string;
	if (!vulnId) {
		console.error('Ошибка парса ID уязвимости');
		return NextResponse.json(
			{},
			{
				status: 400,
			},
		);
	}

	const vuln = await prisma.vulnerabilities.findFirst({
		where: {
			id: {
				equals: vulnId,
			},
		},
	});

	if (!vuln) {
		console.error('Уязвимость не найдена');
		return NextResponse.json(
			{},
			{
				status: 404,
			},
		);
	}

	return NextResponse.json(vuln, {
		status: 200,
	});
}

export { GET };
